{% comment %}
  Submission Card Component - Playful Youth-Friendly Design with Quick Look
  Usage: {% include submission-card.html submission=submission %}

  Features:
  - Cover image with designer badge
  - Labeled vote stats matching detail page
  - Quick Look button for modal preview
  - JSON payload for zero-latency modal data
{% endcomment %}

{% assign design_id = include.submission.year | append: '/' | append: include.submission.slug %}
<article class="submission-card tsg-card group relative overflow-hidden rounded-3xl
                bg-white border-2 border-brand-sky/10
                shadow-lg shadow-brand-indigo/5
                transition-all duration-300 ease-out
                hover:-translate-y-2 hover:rotate-[0.5deg]
                hover:shadow-xl hover:shadow-brand-sky/15
                hover:border-brand-sky/30
                dark:bg-gray-900 dark:border-gray-700 dark:hover:border-brand-sky/50"
         data-design-card
         data-design-id="{{ design_id }}"
         data-submission-id="{{ include.submission.slug }}"
         data-submission-features="{{ include.submission.feature_focus | join: ',' }}"
         data-submission-votes-favorite="{{ include.submission.votes.favorite | default: 0 }}"
         data-submission-votes-innovative="{{ include.submission.votes.innovative | default: 0 }}"
         data-submission-votes-inclusive="{{ include.submission.votes.inclusive | default: 0 }}"
         data-submission-date="{{ include.submission.created_at }}">

  <!-- Cover Image -->
  <a href="{{ include.submission.url | relative_url }}"
     class="block relative aspect-[16/10] overflow-hidden">
    {% assign cover_img = include.submission.cover_image | default: include.submission.thumbnail %}
    {% if cover_img %}
    <picture>
      <source srcset="{{ cover_img | replace: '.png', '.webp' | replace: '.jpeg', '.webp' | relative_url }}" type="image/webp">
      <img class="h-full w-full object-cover transition-transform duration-500
                  group-hover:scale-105"
           src="{{ cover_img | relative_url }}"
           alt="{{ include.submission.thumbnail_alt | default: include.submission.title }}"
           loading="lazy"
           decoding="async">
    </picture>
    {% else %}
    <div class="h-full w-full bg-gradient-to-br from-brand-sky/20 to-brand-indigo/20
                flex items-center justify-center dark:from-brand-sky/10 dark:to-brand-indigo/10">
      <svg class="h-16 w-16 text-brand-sky/40" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
    </div>
    {% endif %}
    <div class="absolute inset-0 bg-gradient-to-t from-brand-navy/70 via-brand-navy/20 to-transparent"></div>

    <!-- Build cart badge -->
    <div class="absolute top-3 right-3 hidden items-center gap-1 rounded-full
                bg-brand-sea/90 backdrop-blur-sm px-2.5 py-1
                text-[11px] font-bold text-white shadow-sm
                pointer-events-none"
         data-remix-card-badge
         data-remix-card-source="{{ include.submission.slug }}"
         aria-label="Features from this design in your build">
      <span aria-hidden="true">üß©</span>
      <span data-remix-card-badge-count aria-live="polite">0</span>
      <span>added</span>
    </div>

    <!-- Designer badge -->
    <div class="absolute bottom-3 left-3 right-3 flex items-center justify-between">
      <span class="inline-flex items-center gap-1.5 rounded-full
                   bg-white/90 backdrop-blur-sm px-3 py-1
                   text-xs font-medium text-brand-navy
                   shadow-sm">
        Made by {{ include.submission.designer }}
      </span>
      {% if include.submission.grade %}
      <span class="rounded-full bg-brand-gold/90 px-2 py-0.5
                   text-[11px] font-bold uppercase tracking-wide text-brand-navy
                   shadow-sm">
        {{ include.submission.grade | split: ' ' | first }}
      </span>
      {% endif %}
    </div>
  </a>

  <!-- Content -->
  <div class="p-5">
    <a href="{{ include.submission.url | relative_url }}" class="block">
      <h3 class="text-lg font-semibold text-brand-navy line-clamp-2
                 group-hover:text-brand-indigo transition-colors
                 dark:text-gray-100 dark:group-hover:text-brand-sky">
        {{ include.submission.title }}
      </h3>
      {% if include.submission.summary %}
      <p class="mt-2 text-sm text-brand-stone line-clamp-2 dark:text-gray-400">
        {{ include.submission.summary }}
      </p>
      {% endif %}
    </a>

    <!-- Feature badges -->
    {% if include.submission.feature_focus %}
    <div class="mt-3 flex flex-wrap gap-1.5">
      {% for feature in include.submission.feature_focus limit:3 %}
        {% assign feature_data = site.feature_categories | where: "id", feature | first %}
        <span class="inline-flex items-center gap-1 rounded-full
                     bg-brand-sky/10 px-2 py-0.5
                     text-[11px] font-semibold uppercase tracking-wide text-brand-indigo
                     dark:bg-brand-sky/20 dark:text-brand-sky">
          {{ feature_data.label | default: feature }}
        </span>
      {% endfor %}
    </div>
    {% endif %}

    <!-- LABELED Vote Stats (matching detail page) -->
    <ul class="mt-4 flex flex-wrap gap-3 text-sm">
      <li class="flex items-center gap-1.5">
        <span aria-hidden="true">üíñ</span>
        <span class="font-bold tabular-nums text-vote-favorite" data-vote-count>{{ include.submission.votes.favorite | default: 0 }}</span>
        <span class="text-brand-stone text-xs dark:text-gray-500">I'd use this</span>
      </li>
      <li class="flex items-center gap-1.5">
        <span aria-hidden="true">‚ú®</span>
        <span class="font-bold tabular-nums text-orange-700" data-vote-count>{{ include.submission.votes.innovative | default: 0 }}</span>
        <span class="text-brand-stone text-xs dark:text-gray-500">Creative</span>
      </li>
      <li class="flex items-center gap-1.5">
        <span aria-hidden="true">üåç</span>
        <span class="font-bold tabular-nums text-brand-sea" data-vote-count>{{ include.submission.votes.inclusive | default: 0 }}</span>
        <span class="text-brand-stone text-xs dark:text-gray-500">For everyone</span>
      </li>
    </ul>
  </div>

  <!-- Feature-Add Chips (Remix) -->
  {% if include.submission.features and include.submission.features.size > 0 %}
  <div class="border-t border-brand-sky/10 px-5 pb-1 pt-3 dark:border-gray-700">
    <p class="text-xs font-medium text-brand-stone dark:text-gray-500 mb-1.5">Add to your build</p>
    <div class="flex flex-wrap gap-1.5">
      {% for feature in include.submission.features limit:4 %}
      <button type="button"
              class="tsg-chip text-xs py-1 px-2 hover:bg-brand-sea/15 hover:border-brand-sea"
              data-remix-add="{{ feature.id }}"
              data-remix-name="{{ feature.name }}"
              data-remix-icon="{{ feature.icon | default: 'üéØ' }}"
              data-remix-source="{{ include.submission.slug }}"
              data-remix-source-title="{{ include.submission.title }}"
              data-remix-source-thumbnail="{{ include.submission.cover_image | default: include.submission.thumbnail | relative_url }}"
              data-remix-source-designer="{{ include.submission.designer }}"
              data-remix-source-url="{{ include.submission.url | relative_url }}"
              aria-pressed="false">
        <span aria-hidden="true">{{ feature.icon | default: 'üéØ' }}</span>
        <span data-remix-label>{{ feature.name }}</span>
      </button>
      {% endfor %}
      {% if include.submission.features.size > 4 %}
      <a href="{{ include.submission.url | relative_url }}"
         class="tsg-chip text-xs py-1 px-2 text-brand-indigo dark:text-brand-sky">
        +{{ include.submission.features.size | minus: 4 }} more
      </a>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <!-- Card Actions -->
  <div class="border-t border-brand-sky/10 p-3 dark:border-gray-700">
    <button type="button"
            class="tsg-chip w-full justify-center hover:bg-brand-sky/20"
            data-quicklook>
      <span aria-hidden="true">üëÄ</span>
      <span>Quick Look</span>
    </button>
  </div>

  <!-- JSON payload for Quick Look modal (zero network latency) -->
  <script type="application/json" data-design-json>
  {
    "title": {{ include.submission.title | jsonify }},
    "summary": {{ include.submission.summary | jsonify }},
    "url": {{ include.submission.url | relative_url | jsonify }},
    "designer": {{ include.submission.designer | jsonify }},
    "grade": {{ include.submission.grade | jsonify }},
    "feature_focus": {{ include.submission.feature_focus | jsonify }},
    "votes": {
      "favorite": {{ include.submission.votes.favorite | default: 0 }},
      "innovative": {{ include.submission.votes.innovative | default: 0 }},
      "inclusive": {{ include.submission.votes.inclusive | default: 0 }}
    },
    "demo_url": {{ include.submission.links.demo_url | jsonify }},
    "screens": {% if include.submission.screens %}[{% for screen in include.submission.screens %}{"src": {{ screen.src | relative_url | jsonify }}, "alt": {{ screen.alt | default: include.submission.title | append: " screen" | jsonify }}, "caption": {{ screen.caption | jsonify }}}{% unless forloop.last %},{% endunless %}{% endfor %}]{% elsif include.submission.images %}[{% for img in include.submission.images %}{"src": {{ img | relative_url | jsonify }}, "alt": {{ include.submission.title | append: " screen" | jsonify }}}{% unless forloop.last %},{% endunless %}{% endfor %}]{% else %}[]{% endif %},
    "cover_image": {{ include.submission.cover_image | default: include.submission.thumbnail | relative_url | jsonify }},
    "creator_note": {{ include.submission.creator_note | jsonify }},
    "voteKey": {{ include.submission.slug | jsonify }},
    "slug": {{ include.submission.slug | jsonify }},
    "features": {% if include.submission.features %}{{ include.submission.features | jsonify }}{% else %}[]{% endif %}
  }
  </script>
</article>
